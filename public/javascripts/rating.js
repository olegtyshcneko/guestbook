// Generated by CoffeeScript 1.4.0
(function() {
  var parseId, parseRate, toggle, toggleRated, toggleRight, toggleUnrated, updateRating;

  parseId = function(id) {
    return id.substring(0, id.indexOf("-"));
  };

  parseRate = function(id) {
    return parseInt(id[id.length - 1]);
  };

  toggleRated = function(element) {
    return element.className = "rated";
  };

  window.toggleLeft = function(id) {
    var i, index, _i, _results;
    index = parseRate(id);
    _results = [];
    for (i = _i = 1; 1 <= index ? _i <= index : _i >= index; i = 1 <= index ? ++_i : --_i) {
      _results.push(toggleRated(document.getElementById("" + (parseId(id)) + "-" + i)));
    }
    return _results;
  };

  toggleUnrated = function(element) {
    return element.className = "unrated";
  };

  toggleRight = function(id) {
    var i, index, _i, _results;
    index = parseRate(id);
    _results = [];
    for (i = _i = 5; 5 <= index ? _i < index : _i > index; i = 5 <= index ? ++_i : --_i) {
      _results.push(toggleUnrated(document.getElementById("" + (parseId(id)) + "-" + i)));
    }
    return _results;
  };

  toggle = function(element) {
    if (element.className === "unrated") {
      return toggleLeft(element.id);
    } else {
      return toggleRight(element.id);
    }
  };

  updateRating = function(pId, rate) {
    return $.ajax({
      type: "POST",
      url: "/updateRating",
      data: {
        postId: pId,
        newRating: rate
      }
    }).success(function() {
      return console.log("rating updated");
    });
  };

  jQuery(function() {
    $(".unrated").click(function(data) {
      toggle(this);
      return updateRating(parseId(this.id), parseRate(this.id));
    });
    return $(".rated").click(function(data) {
      toggle(this);
      return updateRating(parseId(this.id), parseRate(this.id));
    });
  });

}).call(this);
